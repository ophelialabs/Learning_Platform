@page "/universities"
@rendermode InteractiveServer

<PageTitle>Top 100 Universities Worldwide - Ranked by Academic Excellence</PageTitle>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .container-main {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        text-align: center;
        color: white;
        margin-bottom: 50px;
        animation: slideDown 0.6s ease-out;
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .header h1 {
        font-weight: 700;
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
    }

    .header p {
        font-size: 1.2rem;
        opacity: 0.95;
        font-style: italic;
    }

    .stats-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
        animation: fadeIn 0.8s ease-out 0.1s both;
    }

    .stat-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 10px;
    }

    .stat-label {
        font-size: 1rem;
        color: #666;
    }

    .filter-section {
        margin-bottom: 40px;
        text-align: center;
        animation: fadeIn 0.8s ease-out 0.2s both;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .filter-section input {
        max-width: 600px;
        padding: 15px 25px;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .filter-section input:focus {
        outline: none;
        box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        transform: scale(1.02);
    }

    .filter-section input::placeholder {
        color: #aaa;
    }

    .sort-section {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 40px;
        animation: fadeIn 0.8s ease-out 0.3s both;
    }

    .sort-btn {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
        padding: 10px 20px;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .sort-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }

    .sort-section button.active {
        background: #667eea;
        color: white;
    }

    .ranking-group {
        margin-bottom: 50px;
        animation: fadeIn 0.8s ease-out 0.4s both;
    }

    .ranking-group-title {
        background: white;
        color: #667eea;
        font-size: 1.8rem;
        font-weight: 700;
        padding: 20px 30px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 6px solid #667eea;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .ranking-group-title i {
        font-size: 2rem;
    }

    .universities-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
    }

    .university-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        overflow: hidden;
        border-left: 5px solid #667eea;
        display: flex;
        flex-direction: column;
        height: 100%;
        position: relative;
        cursor: pointer;
        text-decoration: none;
        color: inherit;
    }

    .university-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
        border-left-color: #764ba2;
    }

    a.university-card {
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .university-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .card-body {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .rank-badge {
        display: inline-block;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 0.95rem;
        margin-bottom: 15px;
        min-width: 90px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .rank-badge.top-10 {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
    }

    .rank-badge.top-25 {
        background: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
        box-shadow: 0 2px 8px rgba(192, 192, 192, 0.4);
    }

    .university-name {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
    }

    .country {
        font-size: 1rem;
        color: #666;
        margin-bottom: 8px;
    }

    .dept-badge {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-top: 8px;
        margin-right: 4px;
    }

    .department-filter-section {
        margin-bottom: 40px;
        padding: 30px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .department-filter-title {
        color: #667eea;
        font-weight: 700;
        margin-bottom: 20px;
        font-size: 1.1rem;
    }

    .department-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .dept-btn {
        background: #f0f0f0;
        color: #333;
        border: 2px solid #f0f0f0;
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .dept-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .dept-btn.active {
        background: #667eea;
        color: white;
        border-color: #764ba2;
    }

    .no-results {
        text-align: center;
        color: white;
        font-size: 1.2rem;
        padding: 40px;
    }
</style>

<div class="container-main">
    <!-- Header -->
    <div class="header">
        <h1><i class="bi bi-mortarboard-fill"></i> Top 100 Universities Worldwide</h1>
        <p>Ranked by Academic Excellence & Global Impact</p>
    </div>

    <!-- Statistics -->
    <div class="stats-section">
        <div class="stat-card">
            <div class="stat-number">100</div>
            <div class="stat-label">Universities</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">40+</div>
            <div class="stat-label">Countries</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">500+</div>
            <div class="stat-label">Years Combined Excellence</div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <input type="text" @bind:get="searchTerm" @bind:set="OnSearchChanged" placeholder="Search by university name or country..." class="form-control">
    </div>

    <!-- Sort Section -->
    <div class="sort-section">
        <button class="sort-btn @(currentSort == "rank" ? "active" : "")" @onclick="@(() => SortBy("rank"))">By Rank</button>
        <button class="sort-btn @(currentSort == "name" ? "active" : "")" @onclick="@(() => SortBy("name"))">By Name</button>
        <button class="sort-btn @(currentSort == "country" ? "active" : "")" @onclick="@(() => SortBy("country"))">By Country</button>
    </div>

    <!-- Department Filter Section -->
    <div class="department-filter-section">
        <div class="department-filter-title">Filter by R&D Department:</div>
        <div class="department-buttons">
            <button class="dept-btn @(selectedDepartment == "all" ? "active" : "")" @onclick="@(() => SelectDepartment("all"))">All Departments</button>
            <button class="dept-btn @(selectedDepartment == "aerospace" ? "active" : "")" @onclick="@(() => SelectDepartment("aerospace"))">Aerospace Engineering</button>
            <button class="dept-btn @(selectedDepartment == "biomedical" ? "active" : "")" @onclick="@(() => SelectDepartment("biomedical"))">BioMedical Engineering</button>
            <button class="dept-btn @(selectedDepartment == "biotech" ? "active" : "")" @onclick="@(() => SelectDepartment("biotech"))">BioTechnology</button>
            <button class="dept-btn @(selectedDepartment == "chemistry" ? "active" : "")" @onclick="@(() => SelectDepartment("chemistry"))">Chemistry</button>
            <button class="dept-btn @(selectedDepartment == "engineering" ? "active" : "")" @onclick="@(() => SelectDepartment("engineering"))">Engineering</button>
            <button class="dept-btn @(selectedDepartment == "geospatial" ? "active" : "")" @onclick="@(() => SelectDepartment("geospatial"))">Geospatial Analytics</button>
            <button class="dept-btn @(selectedDepartment == "mathematics" ? "active" : "")" @onclick="@(() => SelectDepartment("mathematics"))">Mathematics</button>
            <button class="dept-btn @(selectedDepartment == "nanolith" ? "active" : "")" @onclick="@(() => SelectDepartment("nanolith"))">Nanolithography</button>
            <button class="dept-btn @(selectedDepartment == "nuclear" ? "active" : "")" @onclick="@(() => SelectDepartment("nuclear"))">Nuclear Engineering</button>
            <button class="dept-btn @(selectedDepartment == "physics" ? "active" : "")" @onclick="@(() => SelectDepartment("physics"))">Physics</button>
            <button class="dept-btn @(selectedDepartment == "textiles" ? "active" : "")" @onclick="@(() => SelectDepartment("textiles"))">Textiles</button>
        </div>
    </div>

    <!-- Universities List -->
    <div id="universitiesList">
        @if (filteredUniversities.Count == 0)
        {
            <div class="no-results">No institutions found matching your filters. Try a different search or department.</div>
        }
        else
        {
            @foreach (var uniSection in groupedUniversities)
            {
                <div class="ranking-group">
                    <div class="ranking-group-title">@uniSection.Title</div>
                    <div class="universities-grid">
                        @foreach (var uni in uniSection.Universities)
                        {
                            <a href="@uni.Website" class="university-card" target="_blank" rel="noopener noreferrer" title="@uni.Keywords">
                                <div class="card-body">
                                    <span class="rank-badge @(uni.Rank <= 10 ? "top-10" : uni.Rank <= 25 ? "top-25" : "")">
                                        #@uni.Rank
                                    </span>
                                    <h5 class="university-name">@uni.Name</h5>
                                    <p class="country">@uni.Flag @uni.Country</p>
                                    <p style="font-size: 0.85rem; color: #666; margin-top: 8px;"><strong>Type:</strong> @uni.Type</p>
                                    <div style="margin-top: 10px;">
                                        @foreach (var dept in uni.Departments)
                                        {
                                            <span class="dept-badge">@GetDepartmentLabel(dept)</span>
                                        }
                                    </div>
                                </div>
                            </a>
                        }
                    </div>
                </div>
            }
        }
    </div>
</div>

@code {
    private string searchTerm = "";
    private string currentSort = "rank";
    private string selectedDepartment = "all";
    private List<University> universities = new();
    private List<University> filteredUniversities = new();
    private List<UniversitySection> groupedUniversities = new();

    protected override void OnInitialized()
    {
        InitializeUniversities();
        UpdateFilteredResults();
    }

    private void InitializeUniversities()
    {
        universities = new()
        {
            new University { Rank = 1, Name = "Harvard University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.harvard.edu", Keywords = "Harvard University research", Departments = new() { "biomedical", "chemistry", "physics", "mathematics" } },
            new University { Rank = 2, Name = "Stanford University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.stanford.edu", Keywords = "Stanford research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 3, Name = "MIT", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.mit.edu", Keywords = "MIT research", Departments = new() { "aerospace", "engineering", "nanolith", "nuclear", "physics" } },
            new University { Rank = 4, Name = "University of Oxford", Country = "United Kingdom", Flag = "üá¨üáß", Type = "University", Website = "https://www.ox.ac.uk", Keywords = "Oxford research", Departments = new() { "chemistry", "engineering", "mathematics", "physics" } },
            new University { Rank = 5, Name = "University of Cambridge", Country = "United Kingdom", Flag = "üá¨üáß", Type = "University", Website = "https://www.cam.ac.uk", Keywords = "Cambridge research", Departments = new() { "biomedical", "chemistry", "mathematics", "physics" } },
            new University { Rank = 6, Name = "Caltech", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.caltech.edu", Keywords = "Caltech research", Departments = new() { "aerospace", "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 7, Name = "University of Chicago", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.uchicago.edu", Keywords = "Chicago research", Departments = new() { "chemistry", "mathematics", "nuclear", "physics" } },
            new University { Rank = 8, Name = "Imperial College London", Country = "United Kingdom", Flag = "üá¨üáß", Type = "University", Website = "https://www.imperial.ac.uk", Keywords = "Imperial College research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 9, Name = "UC Berkeley", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.berkeley.edu", Keywords = "Berkeley research", Departments = new() { "aerospace", "biomedical", "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 10, Name = "Yale University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.yale.edu", Keywords = "Yale research", Departments = new() { "biomedical", "chemistry", "physics" } },
            new University { Rank = 11, Name = "CERN", Country = "Switzerland", Flag = "üá®üá≠", Type = "Research Facility", Website = "https://www.cern.ch", Keywords = "CERN physics research", Departments = new() { "nuclear", "physics", "mathematics", "engineering" } },
            new University { Rank = 12, Name = "Columbia University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.columbia.edu", Keywords = "Columbia research", Departments = new() { "biomedical", "chemistry", "engineering", "physics" } },
            new University { Rank = 13, Name = "Princeton University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.princeton.edu", Keywords = "Princeton research", Departments = new() { "aerospace", "engineering", "mathematics", "physics" } },
            new University { Rank = 14, Name = "ETH Zurich", Country = "Switzerland", Flag = "üá®üá≠", Type = "University", Website = "https://www.ethz.ch", Keywords = "ETH Zurich research", Departments = new() { "aerospace", "chemistry", "engineering", "nanolith", "physics" } },
            new University { Rank = 15, Name = "Johns Hopkins University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.jhu.edu", Keywords = "Johns Hopkins research", Departments = new() { "biomedical", "chemistry", "engineering" } },
            new University { Rank = 16, Name = "Duke University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.duke.edu", Keywords = "Duke research", Departments = new() { "biomedical", "chemistry", "engineering" } },
            new University { Rank = 17, Name = "Argonne National Laboratory", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.anl.gov", Keywords = "Argonne National Laboratory research", Departments = new() { "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 18, Name = "Los Alamos National Laboratory", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.lanl.gov", Keywords = "Los Alamos research", Departments = new() { "aerospace", "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 19, Name = "Lawrence Berkeley National Lab", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.lbl.gov", Keywords = "Lawrence Berkeley research", Departments = new() { "chemistry", "engineering", "nanolith", "nuclear", "physics" } },
            new University { Rank = 20, Name = "University of Tokyo", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.u-tokyo.ac.jp", Keywords = "Tokyo research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith", "physics" } },
            new University { Rank = 21, Name = "Tsinghua University", Country = "China", Flag = "üá®üá≥", Type = "University", Website = "https://www.tsinghua.edu.cn", Keywords = "Tsinghua research", Departments = new() { "aerospace", "biotech", "chemistry", "engineering", "nanolith" } },
            new University { Rank = 22, Name = "Peking University", Country = "China", Flag = "üá®üá≥", Type = "University", Website = "https://www.pku.edu.cn", Keywords = "Peking research", Departments = new() { "biotech", "chemistry", "mathematics", "physics" } },
            new University { Rank = 23, Name = "University of Melbourne", Country = "Australia", Flag = "üá¶üá∫", Type = "University", Website = "https://www.unimelb.edu.au", Keywords = "Melbourne research", Departments = new() { "biomedical", "chemistry", "engineering", "physics" } },
            new University { Rank = 24, Name = "National University of Singapore", Country = "Singapore", Flag = "üá∏üá¨", Type = "University", Website = "https://www.nus.edu.sg", Keywords = "NUS research", Departments = new() { "biomedical", "engineering", "nanolith", "physics" } },
            new University { Rank = 25, Name = "Northwestern University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.northwestern.edu", Keywords = "Northwestern research", Departments = new() { "chemistry", "engineering", "nanolith", "textiles" } },
            new University { Rank = 26, Name = "EMBL (European Molecular Biology Lab)", Country = "Germany", Flag = "üá©üá™", Type = "Research Facility", Website = "https://www.embl.org", Keywords = "EMBL biomedical research", Departments = new() { "biomedical", "biotech", "chemistry" } },
            new University { Rank = 27, Name = "University of California, San Diego", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.ucsd.edu", Keywords = "UC San Diego research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith" } },
            new University { Rank = 28, Name = "University of Washington", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.washington.edu", Keywords = "UW research", Departments = new() { "biomedical", "engineering", "physics" } },
            new University { Rank = 29, Name = "University of Pennsylvania", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.upenn.edu", Keywords = "Penn research", Departments = new() { "biomedical", "chemistry", "engineering" } },
            new University { Rank = 30, Name = "Cornell University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.cornell.edu", Keywords = "Cornell research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith", "physics" } },
            new University { Rank = 31, Name = "National Institutes of Health (NIH)", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.nih.gov", Keywords = "NIH biomedical research", Departments = new() { "biomedical", "biotech", "chemistry" } },
            new University { Rank = 32, Name = "Georgia Institute of Technology", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.gatech.edu", Keywords = "Georgia Tech research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith", "textiles" } },
            new University { Rank = 33, Name = "University of Michigan", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.umich.edu", Keywords = "Michigan research", Departments = new() { "aerospace", "biomedical", "engineering", "physics" } },
            new University { Rank = 34, Name = "Rice University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.rice.edu", Keywords = "Rice research", Departments = new() { "chemistry", "engineering", "nanolith", "physics" } },
            new University { Rank = 35, Name = "University of Illinois Urbana-Champaign", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.illinois.edu", Keywords = "UIUC research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 36, Name = "Purdue University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.purdue.edu", Keywords = "Purdue research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith" } },
            new University { Rank = 37, Name = "Kyoto University", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.kyoto-u.ac.jp", Keywords = "Kyoto research", Departments = new() { "chemistry", "engineering", "physics" } },
            new University { Rank = 38, Name = "University of Toronto", Country = "Canada", Flag = "üá®üá¶", Type = "University", Website = "https://www.utoronto.ca", Keywords = "Toronto research", Departments = new() { "aerospace", "biomedical", "engineering", "physics" } },
            new University { Rank = 39, Name = "ETH Domain Research Institutes", Country = "Switzerland", Flag = "üá®üá≠", Type = "Research Facility", Website = "https://www.eth-domain.ch", Keywords = "ETH research", Departments = new() { "aerospace", "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 40, Name = "University of Texas at Austin", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.utexas.edu", Keywords = "UT Austin research", Departments = new() { "aerospace", "engineering", "geospatial", "physics" } },
            new University { Rank = 41, Name = "Seoul National University", Country = "South Korea", Flag = "üá∞üá∑", Type = "University", Website = "https://www.snu.ac.kr", Keywords = "Seoul National research", Departments = new() { "biomedical", "chemistry", "engineering", "nanolith" } },
            new University { Rank = 42, Name = "KAIST", Country = "South Korea", Flag = "üá∞üá∑", Type = "University", Website = "https://www.kaist.ac.kr", Keywords = "KAIST research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 43, Name = "University of Tokyo Institute of Space and Astronautical Science", Country = "Japan", Flag = "üáØüáµ", Type = "Research Facility", Website = "https://www.isas.jaxa.jp", Keywords = "ISAS aerospace research", Departments = new() { "aerospace", "physics" } },
            new University { Rank = 44, Name = "Max Planck Institute for Physics", Country = "Germany", Flag = "üá©üá™", Type = "Research Facility", Website = "https://www.mpp.mpg.de", Keywords = "Max Planck physics research", Departments = new() { "physics", "nuclear", "mathematics" } },
            new University { Rank = 45, Name = "University of British Columbia", Country = "Canada", Flag = "üá®üá¶", Type = "University", Website = "https://www.ubc.ca", Keywords = "UBC research", Departments = new() { "biomedical", "engineering", "physics" } },
            new University { Rank = 46, Name = "Ohio State University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.osu.edu", Keywords = "Ohio State research", Departments = new() { "aerospace", "chemistry", "engineering", "physics" } },
            new University { Rank = 47, Name = "University of Wisconsin-Madison", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.wisc.edu", Keywords = "Wisconsin research", Departments = new() { "biomedical", "chemistry", "engineering", "physics" } },
            new University { Rank = 48, Name = "National Center for Atmospheric Research (NCAR)", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://ncar.ucar.edu", Keywords = "NCAR geospatial research", Departments = new() { "geospatial", "physics", "mathematics" } },
            new University { Rank = 49, Name = "Carnegie Mellon University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.cmu.edu", Keywords = "Carnegie Mellon research", Departments = new() { "aerospace", "engineering", "mathematics", "physics" } },
            new University { Rank = 50, Name = "University of Cambridge Institute of Astronomy", Country = "United Kingdom", Flag = "üá¨üáß", Type = "Research Facility", Website = "https://www.ast.cam.ac.uk", Keywords = "Cambridge astronomy research", Departments = new() { "physics", "mathematics" } },
            new University { Rank = 51, Name = "Boston University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.bu.edu", Keywords = "Boston University research", Departments = new() { "biomedical", "engineering", "physics" } },
            new University { Rank = 52, Name = "University of Pennsylvania School of Engineering", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.seas.upenn.edu", Keywords = "Penn engineering research", Departments = new() { "aerospace", "biomedical", "nanolith" } },
            new University { Rank = 53, Name = "Karolinska Institute", Country = "Sweden", Flag = "üá∏üá™", Type = "University", Website = "https://www.ki.se", Keywords = "Karolinska biomedical research", Departments = new() { "biomedical", "biotech", "chemistry" } },
            new University { Rank = 54, Name = "Ludwig Maximilians University Munich", Country = "Germany", Flag = "üá©üá™", Type = "University", Website = "https://www.lmu.de", Keywords = "Munich research", Departments = new() { "chemistry", "mathematics", "physics" } },
            new University { Rank = 55, Name = "University of Sydney", Country = "Australia", Flag = "üá¶üá∫", Type = "University", Website = "https://www.sydney.edu.au", Keywords = "Sydney research", Departments = new() { "biomedical", "chemistry", "engineering" } },
            new University { Rank = 56, Name = "National Aeronautics and Space Administration (NASA)", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.nasa.gov", Keywords = "NASA aerospace research", Departments = new() { "aerospace", "geospatial", "physics", "engineering" } },
            new University { Rank = 57, Name = "University of New South Wales", Country = "Australia", Flag = "üá¶üá∫", Type = "University", Website = "https://www.unsw.edu.au", Keywords = "UNSW research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith" } },
            new University { Rank = 58, Name = "University of Manchester", Country = "United Kingdom", Flag = "üá¨üáß", Type = "University", Website = "https://www.manchester.ac.uk", Keywords = "Manchester research", Departments = new() { "aerospace", "engineering", "physics" } },
            new University { Rank = 59, Name = "University of Southern California", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.usc.edu", Keywords = "USC research", Departments = new() { "aerospace", "biomedical", "engineering" } },
            new University { Rank = 60, Name = "Chinese Academy of Sciences (CAS)", Country = "China", Flag = "üá®üá≥", Type = "Research Facility", Website = "https://www.cas.cn", Keywords = "CAS research", Departments = new() { "chemistry", "engineering", "nanolith", "physics" } },
            new University { Rank = 61, Name = "University of Hong Kong", Country = "Hong Kong", Flag = "üá≠üá∞", Type = "University", Website = "https://www.hku.hk", Keywords = "HKU research", Departments = new() { "biomedical", "chemistry", "engineering" } },
            new University { Rank = 62, Name = "Technical University of Munich", Country = "Germany", Flag = "üá©üá™", Type = "University", Website = "https://www.tum.de", Keywords = "TUM research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 63, Name = "University of Tokyo Engineering", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.t.u-tokyo.ac.jp", Keywords = "Tokyo engineering research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith" } },
            new University { Rank = 64, Name = "National University of Singapore Engineering", Country = "Singapore", Flag = "üá∏üá¨", Type = "University", Website = "https://cde.nus.edu.sg", Keywords = "NUS engineering research", Departments = new() { "aerospace", "biomedical", "engineering", "nanolith" } },
            new University { Rank = 65, Name = "Bell Labs (Nokia Bell Labs)", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.bell-labs.com", Keywords = "Bell Labs research", Departments = new() { "engineering", "nanolith", "physics" } },
            new University { Rank = 66, Name = "University of Cambridge Department of Chemistry", Country = "United Kingdom", Flag = "üá¨üáß", Type = "University", Website = "https://www.ch.cam.ac.uk", Keywords = "Cambridge chemistry research", Departments = new() { "chemistry", "nanolith", "physics" } },
            new University { Rank = 67, Name = "Delft University of Technology", Country = "Netherlands", Flag = "üá≥üá±", Type = "University", Website = "https://www.tudelft.nl", Keywords = "Delft research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 68, Name = "Brookhaven National Laboratory", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.bnl.gov", Keywords = "Brookhaven research", Departments = new() { "chemistry", "nanolith", "nuclear", "physics" } },
            new University { Rank = 69, Name = "University of Tokyo Institute of Industrial Science", Country = "Japan", Flag = "üáØüáµ", Type = "Research Facility", Website = "https://www.iis.u-tokyo.ac.jp", Keywords = "IIS research", Departments = new() { "aerospace", "engineering", "nanolith" } },
            new University { Rank = 70, Name = "KTH Royal Institute of Technology", Country = "Sweden", Flag = "üá∏üá™", Type = "University", Website = "https://www.kth.se", Keywords = "KTH research", Departments = new() { "aerospace", "engineering", "textiles" } },
            new University { Rank = 71, Name = "Emory University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.emory.edu", Keywords = "Emory research", Departments = new() { "biomedical", "biotech", "chemistry" } },
            new University { Rank = 72, Name = "North Carolina State University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.ncsu.edu", Keywords = "NC State research", Departments = new() { "engineering", "nanolith", "textiles" } },
            new University { Rank = 73, Name = "Oak Ridge National Laboratory", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.ornl.gov", Keywords = "Oak Ridge research", Departments = new() { "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 74, Name = "University of G√∂ttingen", Country = "Germany", Flag = "üá©üá™", Type = "University", Website = "https://www.uni-goettingen.de", Keywords = "G√∂ttingen research", Departments = new() { "chemistry", "mathematics", "physics" } },
            new University { Rank = 75, Name = "University of Tokyo Research Center for Advanced Science and Technology", Country = "Japan", Flag = "üáØüáµ", Type = "Research Facility", Website = "https://www.rcast.u-tokyo.ac.jp", Keywords = "RCAST research", Departments = new() { "nanolith", "physics", "engineering" } },
            new University { Rank = 76, Name = "Tokyo Institute of Technology", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.titech.ac.jp", Keywords = "Tokyo Tech research", Departments = new() { "aerospace", "engineering", "nanolith", "physics" } },
            new University { Rank = 77, Name = "Nanyang Technological University", Country = "Singapore", Flag = "üá∏üá¨", Type = "University", Website = "https://www.ntu.edu.sg", Keywords = "NTU research", Departments = new() { "biomedical", "engineering", "nanolith" } },
            new University { Rank = 78, Name = "University of Stuttgart", Country = "Germany", Flag = "üá©üá™", Type = "University", Website = "https://www.uni-stuttgart.de", Keywords = "Stuttgart research", Departments = new() { "aerospace", "engineering", "nanolith" } },
            new University { Rank = 79, Name = "Jefferson Lab (Thomas Jefferson National Accelerator Facility)", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.jlab.org", Keywords = "Jefferson Lab physics research", Departments = new() { "nuclear", "physics", "engineering" } },
            new University { Rank = 80, Name = "University of Science and Technology of China", Country = "China", Flag = "üá®üá≥", Type = "University", Website = "https://www.ustc.edu.cn", Keywords = "USTC research", Departments = new() { "chemistry", "mathematics", "nanolith", "physics" } },
            new University { Rank = 81, Name = "Politecnico di Milano", Country = "Italy", Flag = "üáÆüáπ", Type = "University", Website = "https://www.polimi.it", Keywords = "Politecnico research", Departments = new() { "aerospace", "engineering", "nanolith" } },
            new University { Rank = 82, Name = "University of Tokyo Graduate School of Engineering", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.t.u-tokyo.ac.jp/en", Keywords = "Tokyo engineering graduate research", Departments = new() { "aerospace", "biomedical", "engineering" } },
            new University { Rank = 83, Name = "Ecole Polytechnique Paris", Country = "France", Flag = "üá´üá∑", Type = "University", Website = "https://www.polytechnique.edu", Keywords = "Ecole Polytechnique research", Departments = new() { "aerospace", "engineering", "mathematics", "physics" } },
            new University { Rank = 84, Name = "PSI - Paul Scherrer Institut", Country = "Switzerland", Flag = "üá®üá≠", Type = "Research Facility", Website = "https://www.psi.ch", Keywords = "PSI research", Departments = new() { "chemistry", "engineering", "nuclear", "physics" } },
            new University { Rank = 85, Name = "Hiroshima University", Country = "Japan", Flag = "üáØüáµ", Type = "University", Website = "https://www.hiroshima-u.ac.jp", Keywords = "Hiroshima research", Departments = new() { "chemistry", "engineering", "physics" } },
            new University { Rank = 86, Name = "Fermi National Accelerator Laboratory", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.fnal.gov", Keywords = "Fermilab physics research", Departments = new() { "nuclear", "physics", "engineering" } },
            new University { Rank = 87, Name = "North Carolina State Textile Engineering", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://textiles.ncsu.edu", Keywords = "textile engineering research", Departments = new() { "engineering", "textiles", "chemistry" } },
            new University { Rank = 88, Name = "Hong Kong University of Science and Technology", Country = "Hong Kong", Flag = "üá≠üá∞", Type = "University", Website = "https://www.hkust.edu.hk", Keywords = "HKUST research", Departments = new() { "biomedical", "engineering", "nanolith", "physics" } },
            new University { Rank = 89, Name = "University of Melbourne Institute of Neuroscience", Country = "Australia", Flag = "üá¶üá∫", Type = "Research Facility", Website = "https://www.ion.unimelb.edu.au", Keywords = "Melbourne neuroscience research", Departments = new() { "biomedical", "chemistry", "physics" } },
            new University { Rank = 90, Name = "University of Tokyo Center for Spatial Information Science", Country = "Japan", Flag = "üáØüáµ", Type = "Research Facility", Website = "https://www.csis.u-tokyo.ac.jp", Keywords = "geospatial research Tokyo", Departments = new() { "geospatial", "mathematics", "physics" } },
            new University { Rank = 91, Name = "University of Texas Institute for Geophysics", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.ig.utexas.edu", Keywords = "geophysics geospatial research", Departments = new() { "geospatial", "engineering", "physics" } },
            new University { Rank = 92, Name = "Swedish University of Agricultural Sciences", Country = "Sweden", Flag = "üá∏üá™", Type = "University", Website = "https://www.slu.se", Keywords = "SLU research", Departments = new() { "biotech", "chemistry", "textiles" } },
            new University { Rank = 93, Name = "University of Massachusetts Lowell", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.uml.edu", Keywords = "UMass Lowell research", Departments = new() { "aerospace", "engineering", "nanolith", "textiles" } },
            new University { Rank = 94, Name = "Clemson University", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.clemson.edu", Keywords = "Clemson research", Departments = new() { "aerospace", "biomedical", "engineering", "textiles" } },
            new University { Rank = 95, Name = "Shanghai Jiao Tong University", Country = "China", Flag = "üá®üá≥", Type = "University", Website = "https://www.sjtu.edu.cn", Keywords = "SJTU research", Departments = new() { "aerospace", "engineering", "nanolith" } },
            new University { Rank = 96, Name = "MIT Media Lab", Country = "United States", Flag = "üá∫üá∏", Type = "Research Facility", Website = "https://www.media.mit.edu", Keywords = "MIT Media Lab research", Departments = new() { "engineering", "nanolith", "physics" } },
            new University { Rank = 97, Name = "University of Tokyo Institute of Medical Science", Country = "Japan", Flag = "üáØüáµ", Type = "Research Facility", Website = "https://www.ims.u-tokyo.ac.jp", Keywords = "biomedical research Tokyo", Departments = new() { "biomedical", "biotech", "chemistry" } },
            new University { Rank = 98, Name = "University of Connecticut Polymer Textile", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://www.uconn.edu", Keywords = "textile polymer research", Departments = new() { "chemistry", "engineering", "textiles" } },
            new University { Rank = 99, Name = "National Center for Isotope and Environmental Research", Country = "France", Flag = "üá´üá∑", Type = "Research Facility", Website = "https://www.insu.cnrs.fr", Keywords = "isotope environmental research", Departments = new() { "chemistry", "geospatial", "physics" } },
            new University { Rank = 100, Name = "University of Illinois Chemistry Department", Country = "United States", Flag = "üá∫üá∏", Type = "University", Website = "https://chemistry.illinois.edu", Keywords = "chemistry research", Departments = new() { "chemistry", "mathematics", "nanolith" } },
        };
    }

    private void UpdateFilteredResults()
    {
        filteredUniversities = universities.Where(uni =>
        {
            var searchLower = searchTerm.ToLower();
            var matchesSearch = (uni.Name?.ToLower().Contains(searchLower) ?? false) || (uni.Country?.ToLower().Contains(searchLower) ?? false);
            var matchesDept = selectedDepartment == "all" || uni.Departments.Contains(selectedDepartment);
            return matchesSearch && matchesDept;
        }).ToList();

        // Sort
        if (currentSort == "name")
            filteredUniversities = filteredUniversities.OrderBy(u => u.Name).ToList();
        else if (currentSort == "country")
            filteredUniversities = filteredUniversities.OrderBy(u => u.Country).ToList();
        // rank is default

        // Group
        GroupUniversities();
    }

    private void GroupUniversities()
    {
        groupedUniversities = new();

        var sections = new Dictionary<string, (string Title, List<University> Unis)>
        {
            { "top10", ("üèÜ Top 10 Research Institutions", new()) },
            { "top25", ("‚≠ê Ranks 11-25", new()) },
            { "top50", ("üéì Ranks 26-50", new()) },
            { "top75", ("üìö Ranks 51-75", new()) },
            { "top100", ("üåü Ranks 76-100", new()) }
        };

        foreach (var uni in filteredUniversities)
        {
            if (uni.Rank <= 10) sections["top10"].Unis.Add(uni);
            else if (uni.Rank <= 25) sections["top25"].Unis.Add(uni);
            else if (uni.Rank <= 50) sections["top50"].Unis.Add(uni);
            else if (uni.Rank <= 75) sections["top75"].Unis.Add(uni);
            else sections["top100"].Unis.Add(uni);
        }

        foreach (var section in sections.Values)
        {
            if (section.Unis.Count > 0)
                groupedUniversities.Add(new UniversitySection { Title = section.Title, Universities = section.Unis });
        }
    }

    private void SortBy(string sortType)
    {
        currentSort = sortType;
        UpdateFilteredResults();
    }

    private void SelectDepartment(string dept)
    {
        selectedDepartment = dept;
        UpdateFilteredResults();
    }

    private void OnSearchChanged(string? value)
    {
        searchTerm = value ?? "";
        UpdateFilteredResults();
    }

    private string GetDepartmentLabel(string dept) => dept switch
    {
        "aerospace" => "Aerospace Eng",
        "biomedical" => "BioMedical",
        "biotech" => "BioTech",
        "chemistry" => "Chemistry",
        "engineering" => "Engineering",
        "geospatial" => "Geospatial",
        "mathematics" => "Mathematics",
        "nanolith" => "Nanolith",
        "nuclear" => "Nuclear",
        "physics" => "Physics",
        "textiles" => "Textiles",
        _ => dept
    };

    public class University
    {
        public int Rank { get; set; }
        public string? Name { get; set; }
        public string? Country { get; set; }
        public string? Flag { get; set; }
        public string? Type { get; set; }
        public string? Website { get; set; }
        public string? Keywords { get; set; }
        public List<string> Departments { get; set; } = new();
    }

    public class UniversitySection
    {
        public string? Title { get; set; }
        public List<University> Universities { get; set; } = new();
    }
}
